(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;b=a.WebSharper=a.WebSharper||{};c=b.AspNetCore=b.AspNetCore||{};d=c.Tests=c.Tests||{};e=d.WebSocketClient=d.WebSocketClient||{};f=d.Website=d.Website||{};g=f.SomeRecord=f.SomeRecord||{};h=f.Client=f.Client||{};i=a.ClientServer_JsonDecoder=a.ClientServer_JsonDecoder||{};j=a.ClientServer_JsonEncoder=a.ClientServer_JsonEncoder||{};k=a.ClientServer_Templates=a.ClientServer_Templates||{};l=b&&b.UI;m=l&&l.Doc;n=l&&l.AttrProxy;o=b&&b.Arrays;p=b&&b.Concurrency;q=b&&b.Unchecked;r=a.console;s=b&&b.JavaScript;t=s&&s.Promise;u=b&&b.Utils;v=c&&c.WebSocket;w=v&&v.Client;x=w&&w.WithEncoding;y=a.JSON;z=l&&l.Var$1;A=l&&l.Templating;B=A&&A.Runtime;C=B&&B.Server;D=C&&C.ProviderBuilder;E=C&&C.Handler;F=C&&C.TemplateInstance;G=b&&b.ClientSideJson;H=G&&G.Provider;I=l&&l.Client;J=I&&I.Templates;e.WebSocketTest$120$26=a.id;e.WebSocketTest$111$30=a.id;e.WebSocketTest$37$22=function(K,L){return function(){return function(){return K(L);};};};e.WebSocketTest=function(K){var L,M,N,O,P,Q,R,S;function T(X){L.$0.Post({$:0,$0:X});}function U(X,Y){var Z,_0,_1,_2,_3,_4;Z=m.Element("button",[n.Create("class","retweet-handler btn btn-info"),n.HandlerImpl("click",function(){return function(){return T(Y);};})],[m.TextNode("Retweet!")]);_0=self.document.createElement("div");_1=self.document.createElement("div");_2=self.document.createElement("div").appendChild(Z.elt);_1.innerHTML=(_3=[X,Y],"<div style=\"display:flex;justify-content:center\"><div>"+(o.get(_3,0)==null?"":a.String(o.get(_3,0)))+("</div><div style=\"margin-left:10px\">"+(o.get(_3,1)==null?"":a.String(o.get(_3,1))))+"</div><div>");_4=_0.appendChild(_1);_4.appendChild(_2);O.elt.appendChild(_4);}function V(X,Y){var Z;return p.Start((Z=null,p.Delay(function(){return p.Combine(q.Equals(L,null)?(function(_0){return _0("Trying to connect.");}(function(_0){r.log(_0);}),t.OfAsync(P).then(function(_0){L={$:1,$0:_0};}),p.Zero()):p.Zero(),p.Delay(function(){(function(_0){return _0("Registering");}(function(_0){r.log(_0);}));L.$0.Post({$:1,$0:S.Get()});return p.Zero();}));})),null);}function W(X,Y){var Z;return p.Start((Z=null,p.Delay(function(){return p.Combine(q.Equals(L,null)?(t.OfAsync(P).then(function(_0){L={$:1,$0:_0};}),p.Zero()):p.Zero(),p.Delay(function(){((function(_0){return function(_1){return _0("Tweeting "+u.toSafe(_1));};}(function(_0){r.log(_0);}))(R.Get()));L.$0.Post({$:0,$0:R.Get()});return p.Zero();}));})),null);}L=null;M=m.Element("pre",[],[]);N=m.Element("div",[],[m.Element("h3",[],[m.TextNode("Messages from server")])]);O=m.Element("div",[],[]);P=(Q=null,p.Delay(function(){(function(X){return X("In here!");}(function(X){r.log(X);}));return x.ConnectStateful(function(X){return y.stringify((j.j())(X));},function(X){return(i.j())(y.parse(X));},K,function(){var X;X=null;return p.Delay(function(){return p.Return([0,function(Y){return function(Z){var _0;_0=null;return p.Delay(function(){var _1,_2,_3,_4;(function(_5){return _5("In in here here!");}(function(_5){r.log(_5);}));return p.Combine(Z.$==0?(_1=Z.$0,_1.$==1?(_2=_1.$0,_2.indexOf("")!=-1?(_3=_2.split(","),((function(_5){return function(_6){return _5("ResponseMSG "+u.printArray(u.prettyPrint,_6));};}(function(_5){r.log(_5);}))(_3),_4=o.get(o.get(_3,0).split("\""),3),U(o.get(o.get(_3,1).split("\""),3),_4),p.Zero())):p.Zero()):(function(_5){return _5("A message was sent back");}(function(_5){r.log(_5);}),p.Zero())):(function(_5){return _5("FUCK");}(function(_5){r.log(_5);}),p.Zero()),p.Delay(function(){return p.Return(Y+1);}));});};}]);});});}));t.OfAsync(P).then(function(X){L={$:1,$0:X};});R=z.Create$1("");S=z.Create$1("");return m.Element("div",[],[m.Element("div",[],[m.Input([n.Create("class","form-control")],S),m.Element("button",[n.Create("class","btn btn-primary"),n.HandlerImpl("click",function(X){return function(Y){return V(X,Y);};})],[m.TextNode("Register")])]),m.Element("div",[],[m.Input([n.Create("class","form-control")],R),m.Element("button",[n.Create("class","btn btn-primary"),n.HandlerImpl("click",function(X){return function(Y){return W(X,Y);};})],[m.TextNode("Tweet")])]),N,M,O]);};g.New=function(K){return{Name:K};};h.Main=function(K,L){var M,N,O,P,Q,R;return(M=(N=(O=e.WebSocketTest(L),(P=new D.New$1(),(P.h.push({$:0,$0:"websockettest",$1:O}),P))),(N.h.push({$:1,$0:"aboutpagelink",$1:K}),N)),(Q=E.CompleteHoles(M.k,M.h,[]),(R=new F.New(Q[1],k.body(Q[0])),M.i=R,R))).get_Doc();};i.j=function(){return i._v?i._v:i._v=(H.DecodeUnion(void 0,"$",[[0,[["$0","con",H.Id(),0]]],[1,[["$0","tweet",H.Id(),0]]],[2,[["$0","register",H.Id(),0]]]]))();};j.j=function(){return j._v?j._v:j._v=(H.EncodeUnion(void 0,"$",[[0,[["$0","tweet",H.Id(),0]]],[1,[["$0","account",H.Id(),0]]]]))();};k.body=function(K){J.LoadLocalTemplates("main");return K?J.NamedTemplate("main",{$:1,$0:"body"},K):void 0;};}(self));
