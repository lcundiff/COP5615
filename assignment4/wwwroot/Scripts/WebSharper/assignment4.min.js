(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;b=a.assignment4=a.assignment4||{};c=b.Client=b.Client||{};d=b.ClientFunctions=b.ClientFunctions||{};e=d.Message=d.Message||{};f=a.StartupCode$assignment4$Client=a.StartupCode$assignment4$Client||{};g=a.assignment4_Templates=a.assignment4_Templates||{};h=a.WebSharper;i=h&&h.Concurrency;j=h&&h.Remoting;k=j&&j.AjaxRemotingProvider;l=h&&h.UI;m=l&&l.Var$1;n=l&&l.Templating;o=n&&n.Runtime;p=o&&o.Server;q=p&&p.ProviderBuilder;r=p&&p.Handler;s=p&&p.TemplateInstance;t=a.IntelliFactory;u=t&&t.Runtime;v=h&&h.Utils;w=a.console;x=h&&h.Operators;y=h&&h.List;z=h&&h.Seq;A=h&&h.Collections;B=A&&A.Dictionary;C=h&&h.Arrays;D=h&&h.Random;E=h&&h.Obj;F=l&&l.Client;G=F&&F.Templates;c.Main$38$21=function(H){return function(I){var J;i.StartImmediate((J=null,i.Delay(function(){return i.Bind((new k.New()).Async("assignment4:assignment4.Server.Tweet:1292829125",[I.Vars.Hole("texttoreverse").$1.Get()]),function(K){H.Set(K);return i.Zero();});})),null);};};c.Main=function(){var H,I,J,K,L,M,N;H=m.Create$1("");return(I=(J=H.get_View(),(K=(L=new q.New$1(),(L.h.push(r.EventQ2(L.k,"ontweet",function(){return L.i;},function(O){var P;i.StartImmediate((P=null,i.Delay(function(){return i.Bind((new k.New()).Async("assignment4:assignment4.Server.Tweet:1292829125",[O.Vars.Hole("texttoreverse").$1.Get()]),function(Q){H.Set(Q);return i.Zero();});})),null);})),L)),(K.h.push({$:2,$0:"reversed",$1:J}),K))),(M=r.CompleteHoles(I.k,I.h,[["texttoreverse",0]]),(N=new s.New(M[1],g.mainform(M[0])),I.i=N,N))).get_Doc();};c.myFollowers=function(){f.$cctor();return f.myFollowers;};c.set_myFollowers=function(H){f.$cctor();f.myFollowers=H;};c.connected=function(){f.$cctor();return f.connected;};c.set_connected=function(H){f.$cctor();f.connected=H;};c.liveData=function(){f.$cctor();return f.liveData;};c.showTweets=function(H,I){(((u.Curried3(function(J,K,L){return J(v.toSafe(K)+" tweets "+v.printList(v.prettyPrint,L));}))(function(J){w.log(J);}))(I))(H);};e.Simulate={$:13};e.Success={$:12};e.SubscribedToTweets={$:11};d.simulator=function(){var H,I;(function(J){return J("Welcome to Twitter Simulator, how many accounts would you like to create?");}(function(J){w.log(J);}));d.set_numOfAccounts(x.toInt(1));d.registerAccounts();(((u.Curried3(function(J,K,L){return J(a.String(K)+" zipfSubscribers: "+v.printList(v.prettyPrint,L));}))(function(J){w.log(J);}))(d.zipfSubscribers().get_Length()))(d.zipfSubscribers());for(H=0,I=d.numOfAccounts()-1;H<=I;H++)a.String(H);};d.registerAccounts=function(){var H,I;for(H=0,I=d.numOfAccounts()-1;H<=I;H++)(function(J){var K;d.registerAccount(a.String(H));K=y.ofSeq(z.delay(function(){return z.map(function(){return a.String(J);},x.range(0,(d.numOfAccounts()/(J+1)>>0)-1));}));return d.set_zipfSubscribers(y.append(d.zipfSubscribers(),K));}(H));(function(J){return J("adding clients");}(function(J){w.log(J);}));};d.registerAccount=function(H){d.client(H);d.users().Add(H,H);d.set_clientIds(y.append(d.clientIds(),y.ofArray([H])));d.connectionStatus().Add(H,true);};d.clientIds=function(){f.$cctor();return f.clientIds;};d.set_clientIds=function(H){f.$cctor();f.clientIds=H;};d.client=function(H){var I,J,K,L,M,N,O,P,Q,R,S,T;O=new B.New$5();O.Add("myTweets",y.T.Empty);O.Add("subscribedTo",y.T.Empty);O.Add("hashTag",y.T.Empty);O.Add("mentions",y.T.Empty);O.Add("mySubs",y.T.Empty);I=true;J=y.T.Empty;P="Simulate";if(P==="Simulate"){K=d.numOfAccounts()/20;Q=J.get_Length()/K;R=10+x.toInt(Q);S=60+x.toInt(Q);T=d.random().Next(0,S);if(!I)T<=S/5>>0?((function(U){return function(V){return U(v.toSafe(V)+" is re-connecting.");};}(function(U){w.log(U);}))(H),I=true):void 0;else{L=a.String(d.random().Next$1(d.numOfAccounts()));while(!d.users().ContainsKey(L))L=a.String(d.random().Next$1(d.numOfAccounts()));if(T<=R)O.set_Item("myTweets",d.tweet(H,L,O,T));else T<=R+10?O.set_Item("mySubs",d.subscribe(H,L,O)):T<=R+20?d.unsubscribe(H,O):T<=R+30?((function(U){return function(V){return U(v.toSafe(V)+" is requesting subscribed tweets.");};}(function(U){w.log(U);}))(H),M=y.ofArray([H]),M=y.append(O.get_Item("mySubs"),M)):T<=R+39?(N=d.createRndWord(),(((u.Curried3(function(U,V,W){return U(v.toSafe(V)+" is requesting the hashtag: "+v.toSafe(W)+".");}))(function(U){w.log(U);}))(H))("#"+N)):T===R+40?((function(U){return function(V){return U(v.toSafe(V)+" is disconnecting.");};}(function(U){w.log(U);}))(H),I=false):T<=R+50?(((u.Curried3(function(U,V,W){return U(v.toSafe(V)+" is requesting mentions of "+v.toSafe(W)+".");}))(function(U){w.log(U);}))(H))(L):void 0;}}else P==="AddFollower"?function(U){return U("User: followers now (after adding):");}(function(U){w.log(U);}):P==="RemoveFollower"?function(U){return U("followers now (after removing):");}(function(U){w.log(U);}):P==="ReceiveTweets"?function(U){return U("received tweets");}(function(U){w.log(U);}):P==="AddTweet"?function(U){return U("adding tweet:");}(function(U){w.log(U);}):P==="Success"?function(U){return U("server message succeeded!");}(function(U){w.log(U);}):function(U){return U("ERROR: client recieved unrecognized message");}(function(U){w.log(U);});};d.unsubscribe=function(H,I){var J,K;if(I.get_Item("mySubs").get_Length()>1){J=d.random().Next(1,I.get_Item("mySubs").get_Length());K=I.get_Item("mySubs").get_Item(J);(((u.Curried3(function(L,M,N){return L(v.toSafe(M)+" is unsubscribing from "+v.toSafe(N)+".");}))(function(L){w.log(L);}))(H))(K);d._lock();d.removeFromList(K,I.get_Item("mySubs"));}};d.subscribe=function(H,I,J){var K,L,M;K=I;(((u.Curried3(function(N,O,P){return N(v.toSafe(O)+": in the subscribe method: mySubs "+v.printList(v.prettyPrint,P));}))(function(N){w.log(N);}))(H))(J.get_Item("mySubs"));d._lock();if(d.zipfSubscribers().get_Length()>0){L=d.random().Next$1(d.zipfSubscribers().get_Length());M=0;while(y.contains(d.zipfSubscribers().get_Item(L),J.get_Item("mySubs"))&&M<100){L=d.random().Next$1(d.zipfSubscribers().get_Length());M=M+1;}K=d.zipfSubscribers().get_Item(L);d.set_zipfSubscribers(d.removeAt(L,d.zipfSubscribers()));}else null;(((u.Curried3(function(N,O,P){return N(v.toSafe(O)+" is subscribing to "+v.toSafe(P)+".");}))(function(N){w.log(N);}))(H))(K);return y.append(J.get_Item("mySubs"),y.ofArray([K]));};d.tweet=function(H,I,J,K){var L,M,N;L="#"+d.createRndWord();d.createRndWord();M="User: "+H+" tweeted @"+I;M=M+" "+L;return K<=2?((function(O){return function(P){return O(v.toSafe(P)+" is retweeting.");};}(function(O){w.log(O);}))(H),N=a.String(d.random().Next$1(d.numOfAccounts())),y.append(J.get_Item("myTweets"),y.ofArray([M]))):((function(O){return function(P){return O(v.toSafe(P)+" is tweeting.");};}(function(O){w.log(O);}))(H),y.append(J.get_Item("myTweets"),y.ofArray([M])));};d.removeAt=function(H,I){function J(K,L){return K!==H;}return y.map(function(K){return K[1];},y.filter(function(K){return J(K[0],K[1]);},y.indexed(I)));};d.removeFromList=function(H,I){return y.map(function(J){return J[1];},y.filter(function(J){return J[0];},y.mapi(function(J,K){return[K!==H,K];},I)));};d.createRndWord=function(){var H,I,J;H=d.random().Next(0,10);I=C.concat([C.ofSeq(x.charRange("a","z")),C.ofSeq(x.charRange("A","Z")),C.ofSeq(x.charRange("0","9"))]);J=I.length;return C.init(H,function(){return C.get(I,d.random().Next$1(J));}).join("");};d.zipfSubscribers=function(){f.$cctor();return f.zipfSubscribers;};d.set_zipfSubscribers=function(H){f.$cctor();f.zipfSubscribers=H;};d._lock=function(){f.$cctor();return f._lock;};d.connectionStatus=function(){f.$cctor();return f.connectionStatus;};d.users=function(){f.$cctor();return f.users;};d.numOfAccounts=function(){f.$cctor();return f.numOfAccounts;};d.set_numOfAccounts=function(H){f.$cctor();f.numOfAccounts=H;};d.random=function(){f.$cctor();return f.random;};d.serverIp=function(){f.$cctor();return f.serverIp;};d.clientIp=function(){f.$cctor();return f.clientIp;};f.$cctor=function(){f.$cctor=a.ignore;f.liveData=new B.New$5();c.liveData().Add("myTweets",y.T.Empty);c.liveData().Add("subscribedTo",y.T.Empty);c.liveData().Add("hashTag",y.T.Empty);c.liveData().Add("mentions",y.T.Empty);c.liveData().Add("mySubs",y.T.Empty);f.connected=true;f.myFollowers=y.T.Empty;f.clientIp="localhost";f.serverIp="localhost";f.random=new D.New();f.numOfAccounts=0;f.users=new B.New$5();f.connectionStatus=new B.New$5();f._lock=new E.New();f.zipfSubscribers=y.T.Empty;f.clientIds=y.T.Empty;};g.mainform=function(H){G.LoadLocalTemplates("main");return H?G.NamedTemplate("main",{$:1,$0:"mainform"},H):void 0;};}(self));
